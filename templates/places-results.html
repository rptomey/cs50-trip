{% extends "layout.html" %}

{% block title %}
    Places Results
{% endblock %}

{% block main %}
    <meta id="myData" data-maplat="{{ center_lat }}" data-maplong="{{ center_long }}">
    <div class="map-container" id="results-map"></div>

    <script>
        let places = JSON.parse('{{ places | tojson | safe}}');
        const centerLat = document.querySelector("#myData").dataset.maplat;
        const centerLong = document.querySelector("#myData").dataset.maplong;

        let myMap = L.map('results-map').setView([centerLat, centerLong], 13);

        L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoicnB0b21leTYiLCJhIjoiY2tzNnR1a3R0MDllYTJ6cm90ZGQwaWF3ZiJ9.AnkHyz5TZ_n1LZU_WPtMvw'
        }).addTo(myMap);

        for (let i = 0; i < places.length; i++) {
            let point = places[i];
            let pointLat = point.lat;
            let pointLong = point.long;
            let popupHTML = "<ul><li><b>Name:</b> "
                + point.tags.name
                + "</li><li><b>Lat:</b> "
                + pointLat
                + "</li><li><b>Long:</b> "
                + pointLong;
            let marker = L.marker([pointLat, pointLong]).addTo(myMap);
            marker.bindPopup(popupHTML);
        }
    </script>

{% endblock %}